<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2196F3">
    <meta name="description" content="Check ER wait times and register patients online">
    <meta property="og:title" content="ER Wait Time">
    <meta property="og:description" content="Find emergency rooms near you and check wait times">
    <meta property="og:url" content="https://mywaitime.com">
    <title>ER Wait Time - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Add at the top of your styles */
        :root {
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #636e72;
            --border-color: #e9ecef;
            --primary-color: #2196F3;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            /* Dark theme */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --primary-color: #64B5F6;
            --success-color: #81C784;
            --error-color: #E57373;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px var(--shadow-color);
            z-index: 1000;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Modern Base Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Section */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .login-header img {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .input-group input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .input-group input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .login-button {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .login-button:hover {
            background: #1976D2;
        }

        .error-message {
            color: var(--error-color);
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }

        /* Main Content */
        .main-content {
            display: none;
            position: relative;
            padding-top: 60px;
        }

        .header-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .logout-btn {
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: #1976D2;
        }

        .er-wait-section {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin: 20px 0;
        }

        .er-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .er-header svg {
            width: 40px;
            height: 40px;
        }

        .er-search-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .location-input {
            display: flex;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            margin-bottom: 15px;
            position: relative;
        }

        .location-input i {
            color: #666;
            margin-right: 10px;
        }

        .location-input input {
            border: none;
            outline: none;
            flex: 1;
            padding: 5px;
        }

        .radius-slider {
            width: 100%;
            margin: 15px 0;
        }

        .search-button {
            background: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: var(--transition);
        }

        .search-button:hover {
            background: #1976D2;
        }

        .hospital-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .hospital-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .hospital-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .hospital-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hospital-name {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .hospital-address {
            color: #666;
            font-size: 0.9em;
        }

        .distance-info {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--primary-color);
            font-weight: 500;
        }

        .wait-time-badge {
            background: #E3F2FD;
            padding: 10px 15px;
            border-radius: 20px;
            color: var(--primary-color);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hospital-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: #1976D2;
        }

        .primary {
            background: #4CAF50;
        }

        .primary:hover {
            background: #45a049;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            font-size: 1.2em;
            color: var(--primary-color);
            display: none;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .no-results i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 20px;
        }

        .no-results p {
            color: #666;
            margin: 10px 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hospital-list {
                grid-template-columns: 1fr;
            }
        }

        /* Modern Tab Styles */
        .main-nav {
            background: white;
            padding: 10px;
            border-radius: 15px;
            margin: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .nav-wrapper {
            display: flex;
            position: relative;
            gap: 10px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            color: #666;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .nav-btn i {
            font-size: 20px;
        }

        .nav-btn.active {
            color: var(--primary-color);
        }

        .nav-indicator {
            position: absolute;
            height: 100%;
            width: 25%;
            background: #E3F2FD;
            border-radius: 12px;
            top: 0;
            left: 0;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Tab Content Styles */
        .tab-content-container {
            padding: 20px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .registration-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 500;
            color: #666;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .nav-btn i {
                font-size: 24px;
            }
        }

        /* Modern Tab Animations */
        .tab-content {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .tab-content.active {
            opacity: 1;
            transform: translateY(0);
        }

        .nav-btn {
            position: relative;
            overflow: hidden;
        }

        .nav-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--primary-color);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-btn.active::after {
            width: 80%;
        }

        .nav-btn:hover:not(.active) {
            background: rgba(33, 150, 243, 0.1);
            transform: translateY(-2px);
        }

        /* Card Animations */
        .hospital-card, .patient-card {
            transform: scale(1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hospital-card:hover, .patient-card:hover {
            transform: scale(1.02) translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        /* Form Animations */
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            transform: translateY(0);
            transition: all 0.3s;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            transform: translateY(-2px);
        }

        /* Loading Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading-indicator {
            animation: pulse 1.5s infinite;
        }

        /* Success Animation */
        @keyframes success {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .success-message {
            animation: success 0.5s ease-out;
        }

        @media (max-width: 768px) {
            .nav-wrapper {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 10px;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 1000;
            }

            .nav-btn span {
                font-size: 12px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .search-panel {
                margin: 10px;
                padding: 15px;
            }

            .hospital-card {
                margin: 10px;
            }

            .tab-content-container {
                padding-bottom: 80px;
            }
        }

        @media (max-width: 480px) {
            .nav-btn span {
                display: none;
            }

            .nav-btn i {
                font-size: 24px;
            }

            .hospital-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }
        }

        /* Advanced animations */
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeScale {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .tab-content.active {
            animation: slideInUp 0.4s ease-out;
        }

        .hospital-card, .patient-card {
            animation: fadeScale 0.5s ease-out;
        }

        /* Hover effects */
        .nav-btn:hover {
            transform: translateY(-2px);
            background: var(--primary-color);
            color: white;
        }

        .form-group input:focus ~ label,
        .form-group textarea:focus ~ label {
            transform: translateY(-25px) scale(0.8);
            color: var(--primary-color);
        }

        /* Loading animations */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced mobile styles */
        @media (max-width: 768px) {
            .main-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--bg-primary);
                box-shadow: 0 -2px 10px var(--shadow-color);
                margin: 0;
                padding: 10px;
                z-index: 1000;
            }

            .nav-btn {
                flex-direction: column;
                padding: 10px 5px;
            }

            .nav-btn i {
                font-size: 20px;
                margin-bottom: 5px;
            }

            .nav-btn span {
                font-size: 12px;
            }

            .tab-content-container {
                padding-bottom: 80px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .hospital-card {
                margin: 10px;
            }

            .search-panel {
                margin: 10px;
                padding: 15px;
            }

            .theme-toggle {
                bottom: 80px;
            }
        }

        /* Tablet styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .hospital-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Modern Search Styles */
        .search-container {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1976D2 100%);
            padding: 40px 20px;
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .search-hero {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .search-hero h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: fadeInDown 0.5s ease-out;
        }

        .search-hero p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 30px;
            animation: fadeInUp 0.5s ease-out 0.2s both;
        }

        .search-box-wrapper {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            animation: fadeInUp 0.5s ease-out 0.4s both;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.1);
        }

        .location-detect {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .location-detect:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        .location-detect .tooltip {
            position: absolute;
            bottom: -30px;
            right: 0;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
        }

        .location-detect:hover .tooltip {
            opacity: 1;
            bottom: -25px;
        }

        .quick-filters {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-chip {
            padding: 8px 16px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-chip:hover {
            background: rgba(255,255,255,0.3);
        }

        .filter-chip.active {
            background: white;
            color: var(--primary-color);
        }

        /* Results Styles */
        .results-container {
            padding: 20px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
            background: var(--bg-secondary);
            padding: 5px;
            border-radius: var(--border-radius);
        }

        .view-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: all 0.3s;
        }

        .view-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modern Hospital Card Styles */
        .hospitals-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding: 20px;
        }

        .header-content h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .controls-wrapper {
            display: flex;
            gap: 15px;
        }

        .view-toggle, .sort-controls {
            background: var(--bg-secondary);
            padding: 5px;
            border-radius: 8px;
            display: flex;
            gap: 5px;
        }

        .view-btn, .sort-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .view-btn.active, .sort-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .filters-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin: 0 20px 20px;
        }

        .filter-chips {
            display: flex;
            gap: 10px;
        }

        .chip {
            padding: 6px 12px;
            border-radius: 20px;
            border: none;
            background: white;
            color: var(--text-secondary);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chip.active {
            background: var(--primary-color);
            color: white;
        }

        .chip i {
            font-size: 0.8em;
        }

        .more-filters-btn {
            padding: 8px 16px;
            border: none;
            background: white;
            color: var(--primary-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hospital-card.interactive {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .hospital-card.interactive:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .wait-badge {
            background: #E3F2FD;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .favorite-btn {
            background: none;
            border: none;
            color: #FF4081;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .favorite-btn:hover {
            background: rgba(255, 64, 129, 0.1);
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }

        .stars {
            color: #FFC107;
        }

        .features {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .feature-tag {
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .action-btn.secondary {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .action-btn.info {
            background: white;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
        }

        /* Symptom Bubbles */
        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .symptom-bubble {
            padding: 12px;
            border-radius: 25px;
            border: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .symptom-bubble.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
            transform: scale(1.05);
        }

        .symptom-bubble.active .severity {
            background: rgba(255,255,255,0.2);
        }

        .severity {
            display: flex;
            gap: 5px;
            background: #f5f5f5;
            padding: 3px;
            border-radius: 15px;
        }

        .severity-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .severity-dot.active {
            background: #FF5722;
        }

        /* Medical History Sections */
        .medical-history-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .expandable-section {
            border-bottom: 1px solid #eee;
        }

        .section-title {
            padding: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .section-title:hover {
            background: #f8f9fa;
        }

        .section-title i {
            transition: transform 0.3s;
        }

        .section-title.active i {
            transform: rotate(90deg);
        }

        .section-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
        }

        .section-content.active {
            padding: 15px;
            max-height: 500px;
        }

        /* Interactive Elements */
        .condition-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .condition-chip {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #eee;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .condition-chip.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .add-condition-btn {
            color: var(--primary-color);
            background: none;
            border: 2px dashed var(--primary-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-condition-btn:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        /* Medical History Entry Styles */
        .surgery-entry, .medication-entry {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-row input, .form-row select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .surgery-name, .medication-name {
            flex: 2;
        }

        .surgery-date, .medication-dosage {
            flex: 1;
        }

        .medication-frequency {
            flex: 1;
        }

        .surgery-details {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            min-height: 60px;
        }

        .remove-btn {
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .allergy-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .allergy-chip {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .allergy-chip .remove-btn {
            width: 20px;
            height: 20px;
            font-size: 12px;
        }

        /* Animations */
        .surgery-entry, .medication-entry, .allergy-chip {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Navigation */
            .main-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--bg-primary);
                margin: 0;
                padding: 10px;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 1000;
            }

            .nav-btn {
                padding: 12px 8px;
                flex-direction: column;
                gap: 5px;
            }

            .nav-btn i {
                font-size: 20px;
            }

            .nav-btn span {
                font-size: 12px;
            }

            /* Content Adjustments */
            .tab-content-container {
                padding: 10px;
                padding-bottom: 80px; /* Space for bottom nav */
            }

            /* Form Layout */
            .form-grid {
                grid-template-columns: 1fr;
            }

            .medical-history-section {
                margin: 10px 0;
                padding: 15px;
            }

            /* Symptom Bubbles */
            .symptoms-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 8px;
            }

            .symptom-bubble {
                padding: 8px;
                font-size: 14px;
            }

            /* Expandable Sections */
            .section-content.active {
                padding: 10px;
            }

            /* Form Controls */
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 10px;
                font-size: 14px;
            }

            /* Action Buttons */
            .action-btn {
                width: 100%;
                margin: 5px 0;
            }

            /* Cards */
            .hospital-card {
                margin: 10px 0;
            }

            /* Toast Messages */
            .toast {
                width: 90%;
                left: 5%;
                bottom: 90px; /* Above bottom nav */
            }
        }

        /* Tablet Adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .symptoms-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) {
            .nav-btn:hover {
                transform: none;
            }

            .symptom-bubble:active {
                transform: scale(0.98);
            }

            .action-btn:active {
                opacity: 0.8;
            }

            /* Larger touch targets */
            .severity-dot {
                width: 16px;
                height: 16px;
            }

            .form-group input,
            .form-group select {
                min-height: 44px;
            }

            /* Better scrolling */
            .section-content {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Landscape Mode */
        @media (max-width: 768px) and (orientation: landscape) {
            .main-nav {
                position: static;
                flex-direction: row;
            }

            .nav-btn {
                flex-direction: row;
                justify-content: center;
            }

            .nav-btn i {
                margin-right: 8px;
            }

            .tab-content-container {
                padding-bottom: 20px;
            }

            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* High DPI Screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .icon-image {
                background-size: contain;
            }
        }

        /* Surgery Entry Styles */
        .surgery-entry {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .surgery-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .input-group {
            flex: 1;
            position: relative;
        }

        .surgery-name {
            flex: 2;
        }

        .surgery-date, .surgery-type {
            flex: 1;
        }

        .surgery-details {
            width: 100%;
            resize: vertical;
        }

        .remove-btn {
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.8em;
            margin-top: 4px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Input Styles */
        .surgery-entry input,
        .surgery-entry select,
        .surgery-entry textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .surgery-entry input:focus,
        .surgery-entry select:focus,
        .surgery-entry textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        .surgery-entry .error {
            border-color: var(--error-color);
        }

        /* Add these styles for the allergy modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Allergy Severity Styles */
        .allergy-chip.mild { background: #E3F2FD; }
        .allergy-chip.moderate { background: #FFF3E0; }
        .allergy-chip.severe { background: #FFEBEE; }
    </style>
</head>
<body>
    <!-- Page Loader -->
    <div id="pageLoader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(255,255,255,0.9); z-index: 9999; display: flex; 
        justify-content: center; align-items: center; font-size: 1.2em;">
        <div>
            <i class="fas fa-spinner fa-spin"></i>
            Loading application...
        </div>
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="login-container">
        <div class="login-header">
            <img src="clock-icon.svg" alt="ER Wait Time">
            <h1>ER Wait Time</h1>
        </div>
        <form id="loginForm" class="login-form">
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="username" required placeholder="Username">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="password" required placeholder="Password">
            </div>
            <div id="errorMessage" class="error-message"></div>
            <button type="submit" class="login-button">Login</button>
        </form>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="container main-content">
        <div class="header-controls">
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <nav class="main-nav">
            <div class="nav-wrapper">
                <button class="nav-btn active" data-tab="search">
                    <i class="fas fa-search"></i>
                    <span>Find ER</span>
                </button>
                <button class="nav-btn" data-tab="hospitals">
                    <i class="fas fa-hospital"></i>
                    <span>Hospitals</span>
                </button>
                <button class="nav-btn" data-tab="registration">
                    <i class="fas fa-user-plus"></i>
                    <span>Registration</span>
                </button>
                <button class="nav-btn" data-tab="records">
                    <i class="fas fa-folder-open"></i>
                    <span>Records</span>
                </button>
                <div class="nav-indicator"></div>
            </div>
        </nav>

        <div class="tab-content-container">
            <!-- Search Tab -->
            <section id="searchTab" class="tab-content active">
                <div class="search-container">
                    <div class="search-hero">
                        <h1>Find Emergency Care</h1>
                        <p>Locate nearby emergency rooms and check current wait times</p>
                        <div class="search-box-wrapper">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="location-input" placeholder="Enter your location">
                                <button class="location-detect" onclick="getCurrentLocation()">
                                    <i class="fas fa-crosshairs"></i>
                                    <span class="tooltip">Use current location</span>
                                </button>
                            </div>
                            <div class="radius-slider">
                                <label>Search within: <span id="radius-value">10</span> miles</label>
                                <div class="slider-container">
                                    <input type="range" id="radius-slider" min="5" max="50" value="10" 
                                           oninput="updateRadius(this.value)">
                                    <div class="slider-markers">
                                        <span>5</span>
                                        <span>15</span>
                                        <span>30</span>
                                        <span>50</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="quick-filters">
                        <button class="filter-chip active" data-distance="10">Within 10 miles</button>
                        <button class="filter-chip" data-distance="20">Within 20 miles</button>
                        <button class="filter-chip" data-wait="30">Wait < 30 min</button>
                        <button class="filter-chip" data-type="trauma">Trauma Centers</button>
                    </div>
                </div>
                <div class="results-container">
                    <div class="results-header">
                        <h2>Emergency Rooms Near You</h2>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="map">
                                <i class="fas fa-map"></i>
                            </button>
                        </div>
                    </div>
                    <div class="results-wrapper">
                        <div id="resultsGrid" class="results-grid"></div>
                        <div id="resultsMap" class="results-map"></div>
                    </div>
                </div>
            </section>

            <!-- Hospitals Tab -->
            <section id="hospitalsTab" class="tab-content">
                <div class="hospitals-header">
                    <div class="header-content">
                        <h2><i class="fas fa-hospital"></i> Nearby Hospitals</h2>
                        <p class="subtitle">Find and compare emergency rooms in your area</p>
                    </div>
                    <div class="controls-wrapper">
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="cards">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <div class="sort-controls">
                            <button class="sort-btn active" data-sort="distance">
                                <i class="fas fa-route"></i> Distance
                            </button>
                            <button class="sort-btn" data-sort="wait">
                                <i class="fas fa-clock"></i> Wait Time
                            </button>
                            <button class="sort-btn" data-sort="rating">
                                <i class="fas fa-star"></i> Rating
                            </button>
                        </div>
                    </div>
                </div>

                <div class="filters-bar">
                    <div class="active-filters">
                        <span class="filter-label">Filters:</span>
                        <div class="filter-chips">
                            <button class="chip active" data-filter="all">
                                All <i class="fas fa-times"></i>
                            </button>
                            <button class="chip" data-filter="trauma">
                                Trauma Center <i class="fas fa-times"></i>
                            </button>
                            <button class="chip" data-filter="pediatric">
                                Pediatric ER <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button class="more-filters-btn">
                        <i class="fas fa-sliders-h"></i> More Filters
                    </button>
                </div>

                <div id="hospitalsList" class="hospitals-grid">
                    <!-- Hospital Card Template -->
                    <div class="hospital-card interactive">
                        <div class="card-header">
                            <div class="wait-badge">
                                <i class="fas fa-clock"></i>
                                <span>15 min wait</span>
                            </div>
                            <button class="favorite-btn">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="hospital-info">
                            <h3>Memorial Hospital</h3>
                            <div class="rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                </div>
                                <span>(245 reviews)</span>
                            </div>
                            <p class="address">
                                <i class="fas fa-map-marker-alt"></i>
                                1234 Healthcare Ave, City, State
                            </p>
                            <div class="distance">
                                <i class="fas fa-car"></i>
                                2.5 miles (8 mins)
                            </div>
                        </div>
                        <div class="features">
                            <span class="feature-tag">
                                <i class="fas fa-ambulance"></i> Trauma Center
                            </span>
                            <span class="feature-tag">
                                <i class="fas fa-child"></i> Pediatric ER
                            </span>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn primary">
                                <i class="fas fa-user-plus"></i> Register Now
                            </button>
                            <button class="action-btn secondary">
                                <i class="fas fa-directions"></i> Get Directions
                            </button>
                            <button class="action-btn info" data-tooltip="View Details">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Registration Tab -->
            <section id="registrationTab" class="tab-content">
                <div class="registration-panel">
                    <h2><i class="fas fa-user-plus"></i> Patient Registration</h2>
                    <form id="registrationForm" class="registration-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" name="lastName" required>
                            </div>
                            <div class="form-group">
                                <label>Date of Birth</label>
                                <input type="date" name="dob" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" name="phone" required>
                            </div>
                            <div class="form-group full-width">
                                <label>Selected Hospital</label>
                                <select name="hospital" required>
                                    <option value="">Select Hospital</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label class="section-label">
                                    <i class="fas fa-heartbeat"></i>
                                    Current Symptoms & Complaints
                                </label>
                                <div class="symptoms-grid" id="symptomsGrid">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                                <div class="presenting-complaint">
                                    <label>Describe your main complaint</label>
                                    <textarea name="presentingComplaint" rows="3" placeholder="Please describe what brings you to the ER today..."></textarea>
                                </div>
                            </div>

                            <!-- Add Medical History Sections -->
                            <div class="medical-history-section">
                                <div class="section-header">
                                    <i class="fas fa-notes-medical"></i>
                                    <h3>Medical History</h3>
                                </div>
                                
                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('pastMedical')">
                                        <i class="fas fa-chevron-right"></i>
                                        Past Medical History
                                    </div>
                                    <div class="section-content" id="pastMedical">
                                        <div class="condition-chips">
                                            <button type="button" class="condition-chip" onclick="toggleCondition(this)">Diabetes</button>
                                            <button type="button" class="condition-chip" onclick="toggleCondition(this)">Hypertension</button>
                                            <button type="button" class="condition-chip" onclick="toggleCondition(this)">Heart Disease</button>
                                            <button type="button" class="condition-chip" onclick="toggleCondition(this)">Asthma</button>
                                            <!-- Add more conditions -->
                                        </div>
                                        <button type="button" class="add-condition-btn" onclick="addCustomCondition()">
                                            <i class="fas fa-plus"></i> Add Condition
                                        </button>
                                    </div>
                                </div>

                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('surgicalHistory')">
                                        <i class="fas fa-chevron-right"></i>
                                        Surgical History
                                    </div>
                                    <div class="section-content" id="surgicalHistory">
                                        <div class="surgery-list" id="surgeryList">
                                            <!-- Surgery entries will be added here -->
                                        </div>
                                        <button type="button" class="add-surgery-btn" onclick="addSurgery()">
                                            <i class="fas fa-plus"></i> Add Surgery
                                        </button>
                                    </div>
                                </div>

                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('medications')">
                                        <i class="fas fa-chevron-right"></i>
                                        Current Medications
                                    </div>
                                    <div class="section-content" id="medications">
                                        <div class="medication-list" id="medicationList">
                                            <!-- Medication entries will be added here -->
                                        </div>
                                        <button type="button" class="add-medication-btn" onclick="addMedication()">
                                            <i class="fas fa-plus"></i> Add Medication
                                        </button>
                                    </div>
                                </div>

                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('allergies')">
                                        <i class="fas fa-chevron-right"></i>
                                        Allergies
                                    </div>
                                    <div class="section-content" id="allergies">
                                        <div class="allergy-chips">
                                            <!-- Allergy chips will be added here -->
                                        </div>
                                        <button type="button" class="add-allergy-btn" onclick="addAllergy()">
                                            <i class="fas fa-plus"></i> Add Allergy
                                        </button>
                                    </div>
                                </div>

                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('socialHistory')">
                                        <i class="fas fa-chevron-right"></i>
                                        Social History
                                    </div>
                                    <div class="section-content" id="socialHistory">
                                        <div class="social-history-form">
                                            <!-- Smoking History -->
                                            <div class="habit-section">
                                                <label>Smoking Status</label>
                                                <div class="habit-buttons">
                                                    <button type="button" class="habit-btn" data-status="never" onclick="toggleHabitStatus(this)">Never</button>
                                                    <button type="button" class="habit-btn" data-status="current" onclick="toggleHabitStatus(this)">Current</button>
                                                    <button type="button" class="habit-btn" data-status="former" onclick="toggleHabitStatus(this)">Former</button>
                                                </div>
                                                <div class="smoking-details" style="display: none;">
                                                    <div class="form-row">
                                                        <div class="input-group">
                                                            <label>Packs per day</label>
                                                            <input type="number" min="0" step="0.5" placeholder="e.g., 1.5">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Years of smoking</label>
                                                            <input type="number" min="0" placeholder="e.g., 10">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Quit Date (if former)</label>
                                                            <input type="date">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Alcohol History -->
                                            <div class="habit-section">
                                                <label>Alcohol Consumption</label>
                                                <div class="habit-buttons">
                                                    <button type="button" class="habit-btn" data-status="none" onclick="toggleHabitStatus(this)">None</button>
                                                    <button type="button" class="habit-btn" data-status="social" onclick="toggleHabitStatus(this)">Social</button>
                                                    <button type="button" class="habit-btn" data-status="regular" onclick="toggleHabitStatus(this)">Regular</button>
                                                    <button type="button" class="habit-btn" data-status="heavy" onclick="toggleHabitStatus(this)">Heavy</button>
                                                </div>
                                                <div class="alcohol-details" style="display: none;">
                                                    <div class="form-row">
                                                        <div class="input-group">
                                                            <label>Drinks per week</label>
                                                            <input type="number" min="0" placeholder="e.g., 7">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Type of alcohol</label>
                                                            <select multiple>
                                                                <option value="beer">Beer</option>
                                                                <option value="wine">Wine</option>
                                                                <option value="spirits">Spirits</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Drug Use History -->
                                            <div class="habit-section">
                                                <label>Recreational Drug Use</label>
                                                <div class="habit-buttons">
                                                    <button type="button" class="habit-btn" data-status="never" onclick="toggleHabitStatus(this)">Never</button>
                                                    <button type="button" class="habit-btn" data-status="current" onclick="toggleHabitStatus(this)">Current</button>
                                                    <button type="button" class="habit-btn" data-status="former" onclick="toggleHabitStatus(this)">Former</button>
                                                </div>
                                                <div class="drug-details" style="display: none;">
                                                    <div class="form-row">
                                                        <div class="input-group full-width">
                                                            <label>Substances</label>
                                                            <div class="substance-chips">
                                                                <!-- Will be populated with selectable substance chips -->
                                                            </div>
                                                            <button type="button" class="add-substance-btn" onclick="addSubstance()">
                                                                <i class="fas fa-plus"></i> Add Substance
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Sexual History -->
                                            <div class="habit-section">
                                                <label>Sexual History</label>
                                                <div class="form-row">
                                                    <div class="input-group">
                                                        <label>Sexually Active</label>
                                                        <select>
                                                            <option value="">Select</option>
                                                            <option value="yes">Yes</option>
                                                            <option value="no">No</option>
                                                        </select>
                                                    </div>
                                                    <div class="input-group">
                                                        <label>Partners in last 12 months</label>
                                                        <input type="number" min="0" placeholder="Number of partners">
                                                    </div>
                                                    <div class="input-group">
                                                        <label>Protection Used</label>
                                                        <select multiple>
                                                            <option value="condoms">Condoms</option>
                                                            <option value="birth-control">Birth Control</option>
                                                            <option value="none">None</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Travel History Section -->
                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('travelHistory')">
                                        <i class="fas fa-chevron-right"></i>
                                        Travel History
                                    </div>
                                    <div class="section-content" id="travelHistory">
                                        <div class="travel-form">
                                            <div class="form-row">
                                                <div class="input-group">
                                                    <label>International Travel in Last 6 Months?</label>
                                                    <select onchange="toggleTravelDetails(this)">
                                                        <option value="no">No</option>
                                                        <option value="yes">Yes</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="travelDetails" style="display: none;">
                                                <button type="button" class="add-travel-btn" onclick="addTravelEntry()">
                                                    <i class="fas fa-plus"></i> Add Travel
                                                </button>
                                                <div class="travel-entries">
                                                    <!-- Travel entries will be added here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recent Changes Section -->
                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('recentChanges')">
                                        <i class="fas fa-chevron-right"></i>
                                        Recent Changes (Last 1 Month)
                                    </div>
                                    <div class="section-content" id="recentChanges">
                                        <div class="changes-form">
                                            <div class="change-chips">
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Weight Loss</button>
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Weight Gain</button>
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Diet Change</button>
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Sleep Pattern</button>
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Exercise Routine</button>
                                                <button type="button" class="change-chip" onclick="toggleChange(this)">Medication Change</button>
                                            </div>
                                            <textarea class="changes-notes" placeholder="Describe any significant changes in the last month..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Miscellaneous Section -->
                                <div class="expandable-section">
                                    <div class="section-title" onclick="toggleSection('miscellaneous')">
                                        <i class="fas fa-chevron-right"></i>
                                        Miscellaneous
                                    </div>
                                    <div class="section-content" id="miscellaneous">
                                        <div class="misc-form">
                                            <div class="form-row">
                                                <div class="input-group full-width">
                                                    <label>Occupation</label>
                                                    <input type="text" placeholder="Current occupation">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="input-group">
                                                    <label>Exercise Frequency</label>
                                                    <select>
                                                        <option value="">Select</option>
                                                        <option value="none">None</option>
                                                        <option value="occasional">Occasional</option>
                                                        <option value="regular">Regular</option>
                                                        <option value="frequent">Frequent</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <label>Diet Type</label>
                                                    <select>
                                                        <option value="">Select</option>
                                                        <option value="regular">Regular</option>
                                                        <option value="vegetarian">Vegetarian</option>
                                                        <option value="vegan">Vegan</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="input-group full-width">
                                                    <label>Additional Notes</label>
                                                    <textarea placeholder="Any other relevant information..."></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="primary-btn">
                            <i class="fas fa-paper-plane"></i> Submit Registration
                        </button>
                    </form>
                </div>
            </section>

            <!-- Records Tab -->
            <section id="recordsTab" class="tab-content">
                <div class="records-header">
                    <h2><i class="fas fa-folder-open"></i> Patient Records</h2>
                    <div class="filter-controls">
                        <button class="filter-btn active" data-filter="all">All Records</button>
                        <button class="filter-btn" data-filter="today">Today</button>
                        <button class="filter-btn" data-filter="week">This Week</button>
                    </div>
                </div>
                <div id="recordsList" class="records-grid"></div>
            </section>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Constants
        const validCredentials = {
            username: 'admin',
            password: 'ertime911'
        };

        // Login handler
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            
            if (username === validCredentials.username && password === validCredentials.password) {
                sessionStorage.setItem('isLoggedIn', 'true');
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initGoogleServices();
                getCurrentLocation();
                errorMessage.style.display = 'none';
            } else {
                errorMessage.textContent = 'Invalid username or password';
                errorMessage.style.display = 'block';
                document.getElementById('password').value = '';
            }
        });

        // Core functions
        function getCurrentLocation() {
            console.log('Getting current location...');
            const locationInput = document.getElementById('location-input');
            locationInput.value = 'Detecting location...';
            locationInput.disabled = true;

            if (!navigator.geolocation) {
                console.error('Geolocation not supported');
                locationInput.disabled = false;
                locationInput.value = '';
                alert('Geolocation is not supported by your browser');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                position => {
                    console.log('Location obtained:', position);
                    window.selectedLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    if (!window.geocoder) {
                        console.error('Geocoder not initialized');
                        locationInput.disabled = false;
                        locationInput.value = `${position.coords.latitude}, ${position.coords.longitude}`;
                        searchHospitals();
                        return;
                    }
                    
                    window.geocoder.geocode(
                        { location: window.selectedLocation },
                        (results, status) => {
                            locationInput.disabled = false;
                            if (status === 'OK' && results[0]) {
                                locationInput.value = results[0].formatted_address;
                                searchHospitals();
                            } else {
                                locationInput.value = `${position.coords.latitude}, ${position.coords.longitude}`;
                                searchHospitals();
                            }
                        }
                    );
                },
                error => {
                    console.error('Location error:', error);
                    locationInput.disabled = false;
                    locationInput.value = '';
                    alert('Error getting your location: ' + error.message);
                }
            );
        }

        function searchHospitals() {
            console.log('Searching hospitals...');
            if (!window.selectedLocation) {
                alert('Please select a location first');
                return;
            }

            const hospitalList = document.getElementById('hospital-list');
            const loading = document.getElementById('loading');
            
            hospitalList.innerHTML = '';
            loading.style.display = 'block';

            const radius = document.getElementById('radius-slider').value;
            const location = new google.maps.LatLng(
                window.selectedLocation.lat,
                window.selectedLocation.lng
            );

            console.log('Search location:', location.toString());
            console.log('Search radius:', radius);

            const request = {
                location: location,
                radius: radius * 1609.34, // Convert miles to meters
                type: ['hospital'],
                keyword: 'emergency room'
            };

            if (!window.placesService) {
                console.error('Places service not initialized');
                alert('Error: Map service not initialized. Please refresh the page.');
                loading.style.display = 'none';
                return;
            }

            window.placesService.nearbySearch(request, (results, status) => {
                loading.style.display = 'none';
                console.log('Search status:', status);
                console.log('Results:', results);
                
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                    // Show at least 5 hospitals if available
                    const hospitals = results.slice(0, Math.max(5, results.length));
                    displayResults(hospitals);
                } else {
                    hospitalList.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-hospital-alt"></i>
                            <h3>No Hospitals Found</h3>
                            <p>Try increasing your search radius or try a different location.</p>
                        </div>
                    `;
                }
            });
        }

        // Display results function
        function displayResults(hospitals) {
            const hospitalList = document.getElementById('hospital-list');
            hospitalList.innerHTML = '';

            hospitals.forEach(hospital => {
                const hospitalCard = `
                    <div class="hospital-card">
                        <div class="hospital-info">
                            <h3 class="hospital-name">${hospital.name}</h3>
                            <p class="hospital-address">${hospital.vicinity}</p>
                            <div class="distance-info">
                                <i class="fas fa-car"></i>
                                ${calculateDistance(hospital.geometry.location)} miles
                            </div>
                        </div>
                        <div class="wait-time-badge">
                            <i class="fas fa-clock"></i>
                            ${Math.floor(Math.random() * 120) + 10} min wait
                        </div>
                        <div class="hospital-actions">
                            <button onclick="showDirections('${hospital.place_id}')" class="action-btn">
                                <i class="fas fa-directions"></i>
                                Directions
                            </button>
                            <button onclick="registerAtHospital('${hospital.place_id}')" class="action-btn primary">
                                <i class="fas fa-user-plus"></i>
                                Register
                            </button>
                        </div>
                    </div>
                `;
                hospitalList.innerHTML += hospitalCard;
            });
        }

        // Calculate distance function
        function calculateDistance(hospitalLocation) {
            const userLocation = window.selectedLocation;
            const R = 3959; // Earth's radius in miles
            const lat1 = userLocation.lat * Math.PI / 180;
            const lat2 = hospitalLocation.lat() * Math.PI / 180;
            const lon1 = userLocation.lng * Math.PI / 180;
            const lon2 = hospitalLocation.lng() * Math.PI / 180;

            const dLat = lat2 - lat1;
            const dLon = lon2 - lon1;

            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1) * Math.cos(lat2) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return (R * c).toFixed(1);
        }

        // Show directions function
        function showDirections(placeId) {
            const destination = encodeURIComponent(placeId);
            const origin = encodeURIComponent(`${window.selectedLocation.lat},${window.selectedLocation.lng}`);
            window.open(`https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}&destination_placeId=${placeId}`);
        }

        // Register at hospital function
        function registerAtHospital(placeId) {
            alert(`Registering at hospital with ID: ${placeId}`);
        }

        // Sort hospitals function
        function sortHospitals(criteria) {
            const hospitalList = document.getElementById('hospital-list');
            const hospitals = Array.from(hospitalList.children);

            hospitals.sort((a, b) => {
                if (criteria === 'distance') {
                    const distanceA = parseFloat(a.querySelector('.distance-info').textContent);
                    const distanceB = parseFloat(b.querySelector('.distance-info').textContent);
                    return distanceA - distanceB;
                } else if (criteria === 'wait') {
                    const waitA = parseInt(a.querySelector('.wait-time-badge').textContent);
                    const waitB = parseInt(b.querySelector('.wait-time-badge').textContent);
                    return waitA - waitB;
                }
            });

            hospitalList.innerHTML = '';
            hospitals.forEach(hospital => hospitalList.appendChild(hospital));
        }

        // Error handling
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ' + msg + '\nURL: ' + url + '\nLine: ' + lineNo);
            return false;
        };

        // Remove loader when page is ready
        window.addEventListener('load', function() {
            document.getElementById('pageLoader').style.display = 'none';
        });

        // Add logout function
        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('hospital-list').innerHTML = '';
            document.getElementById('location-input').value = '';
        }

        // Tab switching functionality
        function initTabs() {
            const tabs = document.querySelectorAll('.nav-btn');
            const indicator = document.querySelector('.nav-indicator');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab, index) => {
                tab.addEventListener('click', () => {
                    // Move indicator
                    indicator.style.transform = `translateX(${index * 100}%)`;
                    
                    // Update active states
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show content
                    contents.forEach(c => c.classList.remove('active'));
                    document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
                    
                    // Load content if needed
                    if (tab.dataset.tab === 'hospitals' && window.selectedLocation) {
                        loadHospitals();
                    } else if (tab.dataset.tab === 'records') {
                        loadRecords();
                    }
                });
            });
        }

        // Initialize when document is ready
        document.addEventListener('DOMContentLoaded', initTabs);

        // Form validation with visual feedback
        function initFormValidation() {
            const form = document.getElementById('registrationForm');
            const inputs = form.querySelectorAll('input, select, textarea');

            inputs.forEach(input => {
                // Real-time validation
                input.addEventListener('input', () => {
                    validateInput(input);
                });

                // Blur validation
                input.addEventListener('blur', () => {
                    validateInput(input);
                });
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                let isValid = true;

                inputs.forEach(input => {
                    if (!validateInput(input)) {
                        isValid = false;
                    }
                });

                if (isValid) {
                    submitForm(form);
                }
            });
        }

        function validateInput(input) {
            const wrapper = input.closest('.form-group');
            const errorSpan = wrapper.querySelector('.error-message') || 
                              createErrorSpan(wrapper);
            let isValid = true;

            // Clear previous errors
            input.classList.remove('error', 'success');
            errorSpan.textContent = '';

            // Required field validation
            if (input.required && !input.value) {
                showError(input, errorSpan, 'This field is required');
                isValid = false;
            }

            // Phone number validation
            if (input.type === 'tel' && input.value) {
                const phoneRegex = /^\d{10}$/;
                if (!phoneRegex.test(input.value)) {
                    showError(input, errorSpan, 'Please enter a valid 10-digit phone number');
                    isValid = false;
                }
            }

            // Date validation
            if (input.type === 'date' && input.value) {
                const selectedDate = new Date(input.value);
                const today = new Date();
                if (selectedDate > today) {
                    showError(input, errorSpan, 'Date cannot be in the future');
                    isValid = false;
                }
            }

            if (isValid) {
                input.classList.add('success');
            }

            return isValid;
        }

        function showError(input, errorSpan, message) {
            input.classList.add('error');
            errorSpan.textContent = message;
            input.classList.add('shake');
            setTimeout(() => input.classList.remove('shake'), 500);
        }

        function createErrorSpan(wrapper) {
            const span = document.createElement('span');
            span.className = 'error-message';
            wrapper.appendChild(span);
            return span;
        }

        // Form submission with animation
        async function submitForm(form) {
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            try {
                // Show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <i class="fas fa-circle-notch fa-spin"></i> Submitting...
                `;

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Show success message
                showSuccessMessage('Registration submitted successfully!');
                form.reset();

                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;

            } catch (error) {
                console.error('Submission error:', error);
                showError(submitBtn, 'Error submitting form. Please try again.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Initialize symptoms
        const symptoms = [
            'Fever', 'Cough', 'Shortness of Breath', 'Chest Pain',
            'Headache', 'Nausea', 'Dizziness', 'Fatigue',
            'Abdominal Pain', 'Vomiting', 'Diarrhea', 'Rash',
            'Back Pain', 'Joint Pain', 'Sore Throat', 'Runny Nose',
            'Muscle Aches', 'Weakness', 'Anxiety', 'Depression'
        ];

        function initializeSymptoms() {
            const grid = document.getElementById('symptomsGrid');
            symptoms.forEach(symptom => {
                const bubble = document.createElement('div');
                bubble.className = 'symptom-bubble';
                bubble.innerHTML = `
                    <span>${symptom}</span>
                    <div class="severity">
                        <span class="severity-dot" data-level="1"></span>
                        <span class="severity-dot" data-level="2"></span>
                        <span class="severity-dot" data-level="3"></span>
                    </div>
                `;
                
                bubble.addEventListener('click', () => {
                    bubble.classList.toggle('active');
                });

                bubble.querySelectorAll('.severity-dot').forEach(dot => {
                    dot.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const level = dot.dataset.level;
                        dot.parentElement.querySelectorAll('.severity-dot').forEach(d => {
                            d.classList.toggle('active', d.dataset.level <= level);
                        });
                    });
                });

                grid.appendChild(bubble);
            });
        }

        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'toast success-message';
            toast.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Theme toggling
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            
            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle';
            themeToggle.innerHTML = theme === 'light' ? 
                '<i class="fas fa-moon"></i>' : 
                '<i class="fas fa-sun"></i>';
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeToggle.innerHTML = newTheme === 'light' ? 
                    '<i class="fas fa-moon"></i>' : 
                    '<i class="fas fa-sun"></i>';
            });
            
            document.body.appendChild(themeToggle);
        }

        // Enhanced form validation
        function validateForm() {
            const form = document.getElementById('registrationForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            let isValid = true;

            inputs.forEach(input => {
                const value = input.value.trim();
                const label = input.previousElementSibling;
                
                if (input.required && !value) {
                    showError(input, 'This field is required');
                    isValid = false;
                } else if (input.type === 'tel' && value) {
                    const phoneRegex = /^\d{10}$/;
                    if (!phoneRegex.test(value)) {
                        showError(input, 'Please enter a valid phone number');
                        isValid = false;
                    }
                } else if (input.type === 'email' && value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        showError(input, 'Please enter a valid email');
                        isValid = false;
                    }
                }
            });

            return isValid;
        }

        // Initialize all features
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initFormValidation();
            initTabs();
            initializeSymptoms();
        });

        // Enhanced search functionality
        function initSearch() {
            const searchInput = document.getElementById('location-input');
            const radiusSlider = document.getElementById('radius-slider');
            const filterChips = document.querySelectorAll('.filter-chip');
            const viewButtons = document.querySelectorAll('.view-btn');

            // Initialize autocomplete
            const autocomplete = new google.maps.places.Autocomplete(searchInput, {
                types: ['geocode']
            });

            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    window.selectedLocation = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };
                    searchHospitals();
                }
            });

            // Filter chips
            filterChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    chip.classList.toggle('active');
                    applyFilters();
                });
            });

            // View toggle
            viewButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    viewButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    toggleView(btn.dataset.view);
                });
            });
        }

        function updateRadius(value) {
            document.getElementById('radius-value').textContent = value;
            if (window.selectedLocation) {
                searchHospitals();
            }
        }

        function applyFilters() {
            const activeFilters = Array.from(document.querySelectorAll('.filter-chip.active'))
                .map(chip => chip.dataset);
            
            const results = document.querySelectorAll('.hospital-card');
            results.forEach(result => {
                const matches = activeFilters.every(filter => {
                    if (filter.distance) {
                        return parseFloat(result.dataset.distance) <= parseFloat(filter.distance);
                    }
                    if (filter.wait) {
                        return parseInt(result.dataset.waitTime) <= parseInt(filter.wait);
                    }
                    if (filter.type) {
                        return result.dataset.type === filter.type;
                    }
                    return true;
                });
                
                result.style.display = matches ? 'block' : 'none';
            });
        }

        function toggleView(view) {
            const gridView = document.getElementById('resultsGrid');
            const mapView = document.getElementById('resultsMap');
            
            if (view === 'grid') {
                gridView.style.display = 'grid';
                mapView.style.display = 'none';
            } else {
                gridView.style.display = 'none';
                mapView.style.display = 'block';
                initMap();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initSearch();
            initTheme();
            initTabs();
        });

        // Add these functions to your existing JavaScript
        function initHospitalCards() {
            // Favorite button functionality
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const icon = btn.querySelector('i');
                    icon.classList.toggle('far');
                    icon.classList.toggle('fas');
                    
                    if (icon.classList.contains('fas')) {
                        showToast('Added to favorites');
                    }
                });
            });

            // View toggle functionality
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const view = btn.dataset.view;
                    const container = document.getElementById('hospitalsList');
                    container.className = view === 'cards' ? 'hospitals-grid' : 'hospitals-list';
                });
            });

            // Filter chips functionality
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    chip.classList.toggle('active');
                    applyFilters();
                });
            });
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Section toggle
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const title = section.previousElementSibling;
            
            section.classList.toggle('active');
            title.classList.toggle('active');
        }

        // Condition toggle
        function toggleCondition(element) {
            element.classList.toggle('active');
        }

        // Add custom condition
        function addCustomCondition() {
            const condition = prompt('Enter medical condition:');
            if (condition) {
                const chip = document.createElement('button');
                chip.className = 'condition-chip';
                chip.onclick = () => toggleCondition(chip);
                chip.textContent = condition;
                document.querySelector('.condition-chips').appendChild(chip);
            }
        }

        // Surgery History Management
        function addSurgery() {
            const surgeryList = document.getElementById('surgeryList');
            if (!surgeryList) {
                console.error('Surgery list container not found');
                return;
            }

            const surgeryEntry = document.createElement('div');
            surgeryEntry.className = 'surgery-entry';
            surgeryEntry.innerHTML = `
                <div class="surgery-form">
                    <div class="form-row">
                        <div class="input-group">
                            <input type="text" class="surgery-name" placeholder="Surgery Name" required>
                        </div>
                        <div class="input-group">
                            <input type="date" class="surgery-date" required>
                        </div>
                        <div class="input-group">
                            <select class="surgery-type">
                                <option value="elective">Elective</option>
                                <option value="emergency">Emergency</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <button type="button" class="remove-btn" onclick="removeSurgery(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="form-row">
                        <textarea class="surgery-details" 
                            placeholder="Additional details (complications, outcomes, etc.)" rows="2"></textarea>
                    </div>
                </div>
            `;

            // Add animation
            surgeryEntry.style.opacity = '0';
            surgeryList.appendChild(surgeryEntry);
            
            // Trigger animation
            requestAnimationFrame(() => {
                surgeryEntry.style.opacity = '1';
                surgeryEntry.style.transform = 'translateY(0)';
            });

            // Add validation listeners
            const inputs = surgeryEntry.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', () => validateSurgeryInput(input));
                input.addEventListener('blur', () => validateSurgeryInput(input));
            });
        }

        function removeSurgery(button) {
            const entry = button.closest('.surgery-entry');
            
            // Add removal animation
            entry.style.opacity = '0';
            entry.style.transform = 'translateY(-10px)';
            
            setTimeout(() => {
                entry.remove();
            }, 300);
        }

        function validateSurgeryInput(input) {
            const isValid = input.checkValidity();
            input.classList.toggle('error', !isValid);
            
            if (!isValid && input.value) {
                showInputError(input, 'Please enter valid information');
            } else {
                clearInputError(input);
            }
            
            return isValid;
        }

        function showInputError(input, message) {
            let errorDiv = input.parentElement.querySelector('.error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                input.parentElement.appendChild(errorDiv);
            }
            errorDiv.textContent = message;
        }

        function clearInputError(input) {
            const errorDiv = input.parentElement.querySelector('.error-message');
            if (errorDiv) {
                errorDiv.remove();
            }
        }

        // Add touch event handlers
        function initTouchHandlers() {
            // Swipe between tabs
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);
            
            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);
            
            function handleSwipe() {
                const SWIPE_THRESHOLD = 50;
                const tabs = Array.from(document.querySelectorAll('.nav-btn'));
                const currentTab = document.querySelector('.nav-btn.active');
                const currentIndex = tabs.indexOf(currentTab);
                
                if (touchEndX < touchStartX - SWIPE_THRESHOLD) {
                    // Swipe left
                    const nextTab = tabs[currentIndex + 1];
                    if (nextTab) nextTab.click();
                }
                
                if (touchEndX > touchStartX + SWIPE_THRESHOLD) {
                    // Swipe right
                    const prevTab = tabs[currentIndex - 1];
                    if (prevTab) prevTab.click();
                }
            }

            // Double tap to expand sections
            const sections = document.querySelectorAll('.section-title');
            sections.forEach(section => {
                let lastTap = 0;
                
                section.addEventListener('touchend', e => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 500 && tapLength > 0) {
                        // Double tap detected
                        const content = section.nextElementSibling;
                        content.style.maxHeight = content.scrollHeight + 'px';
                        e.preventDefault();
                    }
                    lastTap = currentTime;
                });
            });
        }

        // Initialize touch handlers
        document.addEventListener('DOMContentLoaded', () => {
            initTouchHandlers();
        });

        // Medication Management
        function addMedication() {
            const medicationList = document.getElementById('medicationList');
            if (!medicationList) {
                console.error('Medication list container not found');
                return;
            }

            const medicationEntry = document.createElement('div');
            medicationEntry.className = 'medication-entry';
            medicationEntry.innerHTML = `
                <div class="medication-form">
                    <div class="form-row">
                        <div class="input-group">
                            <input type="text" class="medication-name" placeholder="Medication Name" required>
                        </div>
                        <div class="input-group">
                            <input type="text" class="medication-dosage" placeholder="Dosage (e.g., 50mg)" required>
                        </div>
                        <div class="input-group">
                            <select class="medication-frequency" required>
                                <option value="">Select Frequency</option>
                                <option value="once">Once Daily</option>
                                <option value="twice">Twice Daily</option>
                                <option value="thrice">Three Times Daily</option>
                                <option value="four">Four Times Daily</option>
                                <option value="asneeded">As Needed</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <select class="medication-route" required>
                                <option value="">Route</option>
                                <option value="oral">Oral</option>
                                <option value="topical">Topical</option>
                                <option value="injection">Injection</option>
                                <option value="inhaled">Inhaled</option>
                            </select>
                        </div>
                        <button type="button" class="remove-btn" onclick="removeMedication(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="form-row">
                        <textarea class="medication-notes" 
                            placeholder="Additional notes (reason for medication, side effects, etc.)" rows="2"></textarea>
                    </div>
                </div>
            `;

            // Add animation
            medicationEntry.style.opacity = '0';
            medicationList.appendChild(medicationEntry);
            
            // Trigger animation
            requestAnimationFrame(() => {
                medicationEntry.style.opacity = '1';
                medicationEntry.style.transform = 'translateY(0)';
            });

            // Add validation
            const inputs = medicationEntry.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', () => validateMedicationInput(input));
                input.addEventListener('blur', () => validateMedicationInput(input));
            });
        }

        function removeMedication(button) {
            const entry = button.closest('.medication-entry');
            entry.style.opacity = '0';
            entry.style.transform = 'translateY(-10px)';
            setTimeout(() => entry.remove(), 300);
        }

        function validateMedicationInput(input) {
            const isValid = input.checkValidity();
            input.classList.toggle('error', !isValid);
            
            if (!isValid && input.value) {
                showInputError(input, 'Please enter valid information');
            } else {
                clearInputError(input);
            }
            return isValid;
        }

        // Allergy Management
        function addAllergy() {
            const allergyChips = document.querySelector('.allergy-chips');
            if (!allergyChips) {
                console.error('Allergy chips container not found');
                return;
            }

            const allergyModal = document.createElement('div');
            allergyModal.className = 'modal';
            allergyModal.innerHTML = `
                <div class="modal-content">
                    <h3>Add Allergy</h3>
                    <div class="form-group">
                        <input type="text" id="allergyName" placeholder="Allergy Name" required>
                    </div>
                    <div class="form-group">
                        <select id="allergySeverity">
                            <option value="mild">Mild</option>
                            <option value="moderate">Moderate</option>
                            <option value="severe">Severe</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea id="allergyReaction" placeholder="Reaction Description"></textarea>
                    </div>
                    <div class="modal-buttons">
                        <button onclick="submitAllergy()" class="primary-btn">Add</button>
                        <button onclick="closeAllergyModal()" class="secondary-btn">Cancel</button>
                    </div>
                </div>
            `;

            document.body.appendChild(allergyModal);
            setTimeout(() => allergyModal.classList.add('show'), 10);
        }

        function submitAllergy() {
            const name = document.getElementById('allergyName').value;
            const severity = document.getElementById('allergySeverity').value;
            const reaction = document.getElementById('allergyReaction').value;

            if (name) {
                const allergyChips = document.querySelector('.allergy-chips');
                const chip = document.createElement('div');
                chip.className = `allergy-chip ${severity}`;
                chip.innerHTML = `
                    <span class="allergy-name">${name}</span>
                    ${reaction ? `<span class="allergy-reaction">${reaction}</span>` : ''}
                    <button onclick="removeAllergy(this)" class="remove-btn">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                allergyChips.appendChild(chip);
                closeAllergyModal();
            }
        }

        function closeAllergyModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 300);
            }
        }

        function removeAllergy(button) {
            const chip = button.closest('.allergy-chip');
            chip.style.opacity = '0';
            chip.style.transform = 'translateY(-10px)';
            setTimeout(() => chip.remove(), 300);
        }

        // Smoking Status Toggle
        function toggleHabitStatus(button) {
            // Remove active state from other buttons in the same group
            const buttons = button.parentElement.querySelectorAll('.habit-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            // Show/hide additional details based on status
            const detailsSection = button.closest('.habit-section').querySelector('[class$="-details"]');
            if (detailsSection) {
                const shouldShow = ['current', 'former', 'social', 'regular', 'heavy'].includes(button.dataset.status);
                detailsSection.style.display = shouldShow ? 'block' : 'none';
                
                // Animate the transition
                if (shouldShow) {
                    detailsSection.style.opacity = '0';
                    detailsSection.style.maxHeight = '0';
                    requestAnimationFrame(() => {
                        detailsSection.style.opacity = '1';
                        detailsSection.style.maxHeight = detailsSection.scrollHeight + 'px';
                    });
                }
            }

            // Special handling for smoking details
            if (button.closest('.habit-section').querySelector('.smoking-details')) {
                const quitDateField = button.closest('.habit-section').querySelector('input[type="date"]');
                if (quitDateField) {
                    quitDateField.parentElement.style.display = button.dataset.status === 'former' ? 'block' : 'none';
                }
            }
        }

        // Substance Management
        function addSubstance() {
            const substances = [
                'Cannabis', 'Cocaine', 'Heroin', 'Methamphetamine', 'MDMA',
                'LSD', 'Prescription Opioids', 'Benzodiazepines', 'Other'
            ];
            
            const modal = document.createElement('div');
            modal.className = 'modal substance-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>Select Substances</h3>
                    <div class="substance-grid">
                        ${substances.map(substance => `
                            <div class="substance-option">
                                <input type="checkbox" id="${substance.toLowerCase()}" value="${substance}">
                                <label for="${substance.toLowerCase()}">${substance}</label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="frequency-section">
                        <label>Frequency of Use</label>
                        <select id="useFrequency">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="occasionally">Occasionally</option>
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button onclick="submitSubstances()" class="primary-btn">Add</button>
                        <button onclick="closeSubstanceModal()" class="secondary-btn">Cancel</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function submitSubstances() {
            const selectedSubstances = Array.from(document.querySelectorAll('.substance-option input:checked'))
                .map(input => input.value);
            const frequency = document.getElementById('useFrequency').value;
            
            if (selectedSubstances.length > 0) {
                const substanceChips = document.querySelector('.substance-chips');
                selectedSubstances.forEach(substance => {
                    const chip = document.createElement('div');
                    chip.className = 'substance-chip';
                    chip.innerHTML = `
                        <span class="substance-name">${substance}</span>
                        <span class="frequency-badge">${frequency}</span>
                        <button onclick="removeSubstance(this)" class="remove-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    substanceChips.appendChild(chip);
                });
            }
            closeSubstanceModal();
        }

        function closeSubstanceModal() {
            const modal = document.querySelector('.substance-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 300);
            }
        }

        function removeSubstance(button) {
            const chip = button.closest('.substance-chip');
            chip.style.opacity = '0';
            chip.style.transform = 'translateY(-10px)';
            setTimeout(() => chip.remove(), 300);
        }

        // Travel History Management
        function toggleTravelDetails(select) {
            const detailsSection = document.getElementById('travelDetails');
            if (select.value === 'yes') {
                detailsSection.style.display = 'block';
                detailsSection.style.opacity = '0';
                requestAnimationFrame(() => {
                    detailsSection.style.opacity = '1';
                });
            } else {
                detailsSection.style.opacity = '0';
                setTimeout(() => {
                    detailsSection.style.display = 'none';
                }, 300);
            }
        }

        function addTravelEntry() {
            const travelEntries = document.querySelector('.travel-entries');
            const entry = document.createElement('div');
            entry.className = 'travel-entry';
            entry.innerHTML = `
                <div class="form-row">
                    <div class="input-group">
                        <label>Country</label>
                        <input type="text" placeholder="Country visited" required>
                    </div>
                    <div class="input-group">
                        <label>Dates</label>
                        <div class="date-range">
                            <input type="date" placeholder="From" required>
                            <input type="date" placeholder="To" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Purpose</label>
                        <select>
                            <option value="tourism">Tourism</option>
                            <option value="business">Business</option>
                            <option value="family">Family Visit</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button type="button" class="remove-btn" onclick="removeTravelEntry(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            entry.style.opacity = '0';
            travelEntries.appendChild(entry);
            requestAnimationFrame(() => {
                entry.style.opacity = '1';
            });
        }

        // Initialize all interactive features
        document.addEventListener('DOMContentLoaded', () => {
            // Add event listeners for habit buttons
            document.querySelectorAll('.habit-btn').forEach(button => {
                button.addEventListener('click', () => toggleHabitStatus(button));
            });
        });
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initGoogleServices">
    </script>
</body>
</html>